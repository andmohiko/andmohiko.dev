---
import SectionHeading from '~/components/typographys/SectionHeading.astro'
import BlogTitleCard from '~/components/cards/BlogTitleCard.astro';
import type { Blog } from '~/types/blog'
import type { FailedToLoadModuleSSR } from 'node_modules/astro/dist/core/errors/errors-data';

interface Props {
  posts: Blog[];
  isShowYear?: boolean;
}

const { posts, isShowYear } = Astro.props;

const showYear = (posts, index, isShowYear) => {
  if (!isShowYear) return false;
  const year = posts[index].fields.publishedAt.slice(0,4);
  if (index === 0) return true;
  const prevYear = posts[index-1].fields.publishedAt.slice(0,4);
  return year !== prevYear;
}
---

<section id="blog" class="blog">
  <SectionHeading>Blog</SectionHeading>
  <div class="blog-list">
    {posts.map((post, index) => (
      <>
        {showYear(posts, index, isShowYear) && (
          <p class="post-year">{post.fields.publishedAt.slice(0,4)}</p>
        )}
        <BlogTitleCard blog={post} />
      </>
    ))}
  </div>
</section>

<style lang="scss" scoped>
.blog {
  width: 100%;
  margin: 80px 0;

  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  gap: 8px;

  .blog-list {
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 8px;

    .post-year {
      font-size: 16px;
      color: #aaaaaa;
      margin-top: 8px;
    }
  }
}
</style>
